<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>platformer</title>

  <style>
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial}
    #game{display:block;background:#87CEEB;width:100vw;height:100vh}
    .hint{position:absolute;left:12px;top:12px;background:rgba(255, 255, 255, 0.85);padding:8px;border-radius:8px}
    .hint2{position:absolute;right:12px;top:12px;background:rgba(255, 255, 255, 0.85);padding:8px;border-radius:8px}
  </style>
</head>

<body>
<canvas id="game"></canvas>
<div class="hint">WASD / Arrow Keys â€” R for new level| K=kys</div>
<div class="hint2">Reach the goal</div>

<script>
// Canvas Setup
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let DPR = Math.max(1, window.devicePixelRatio || 1);

function resize() {
  canvas.width  = innerWidth * DPR;
  canvas.height = innerHeight * DPR;
  canvas.style.width  = innerWidth + 'px';
  canvas.style.height = innerHeight + 'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
addEventListener('resize', resize);
resize();

const a =Math.floor(Math.random() * 5);
  const Sprite=[
    "../pictures/TvTime.png",
    "../pictures/Stitch.png",
    "../pictures/Alastor.png",
    "../pictures/Asriel_PFP_Git.png",
    "../pictures/Cyn.png"];
let playerSprite= new Image();
playerSprite.src =Sprite[a]

const player = {
  x:80, y:100, w:36, h:48,
  vx:0, vy:0,
  speed:360,
  jump:620,
  onGround:false,
  color:'#ff6b6b'
};

const world = {
  gravity: 1800,
  color: '#00308F'
};

let platforms = [];
let movingPlat = [];
let coins = [];
let score = 0;

let bgImg = new Image();

const cam = { x:0, y:0 };
// Generate Level
function level() {

  //background picture
  const r = Math.floor(Math.random() * 6);
  const backgrounds = [
    "../pictures/TvTime.png",
    "../pictures/Stitch.png",
    "../pictures/Alastor.png",
    "../pictures/Asriel_PFP_Git.png",
    "PlayerDesign.png",
    "../pictures/Cyn.png"
  ];
  bgImg.src = backgrounds[r];

  // Random positions
  const minx=440, maxx=1100;
  const miny=180, maxy=420;

  const px  = Math.floor(Math.random()*(maxx+minx))+100;
  const py  = Math.floor(Math.random()*(maxy+miny)-miny);
  const px2 = Math.floor(Math.random()*(maxx+minx))+100;
  const py2 = Math.floor(Math.random()*(maxy+miny)-miny);
  const px3 = Math.floor(Math.random()*(maxx+minx))+100;
  const py3 = Math.floor(Math.random()*(maxy+miny)-miny);

  // Make platforms
  platforms = [
    {x:-10, y:400, w:210, h:28},
    {x:420, y:300, w:220, h:28},
    {x:420, y:180, w:180, h:28},
    {x:px,  y:py,  w:300, h:28},
    {x:px2, y:py2, w:240, h:28},
    {x:px3, y:py3, w:200, h:28},
    {x:2200, y:420, w:800, h:48}
  ];

  // Moving platforms
  movingPlat = [
    {x:420, y:230, w:180, h:28, baseX:420, range:80, speed:40},
    {x:px+300,  y:py+200,  w:180, h:28, baseX:px+300, range:150, speed:80},
    {x:px2+300, y:py2+80,  w:200, h:28, baseX:px2+500, range:180, speed:90},
    {x:px3+300, y:py3+120, w:160, h:28, baseY:300,    range:80, speed:60, vertical:true}
  ];

  platforms.push(...movingPlat);

  // Coins
  const cx  = Math.floor(Math.random()*1100+400);
  const cx1 = Math.floor(Math.random()*1100+400);
  const cx2 = Math.floor(Math.random()*1100+400);
  const cx3 = Math.floor(Math.random()*1100+400);

  coins = [
    {x:450,y:290,r:8, picked:false},
    {x:cx,  y:py-50, r:16, picked:false},
    {x:cx1, y:py+100,r:16, picked:false},
    {x:cx2, y:py-20, r:16, picked:false},
    {x:cx3, y:py+20, r:16, picked:false},
  ];

  reset();
}
// Reset Player
function reset() {
  player.x = 80;
  player.y = 100;
  player.vx = 0;
  player.vy = 0;
  score = 0;
  coins.forEach(c => c.picked = false);
}
// Input
const keys = {};

addEventListener('keydown', e => {
  keys[e.code] = true;

  if (e.code === 'Space') e.preventDefault();

  // Regenerate level
  if (e.code === 'KeyR') {
    level();
  }
});

addEventListener('keyup', e => {
  keys[e.code] = false;
});
// Collision
function rectsIntersect(a,b){
  return a.x < b.x + b.w &&
         a.x + a.w > b.x &&
         a.y < b.y + b.h &&
         a.y + a.h > b.y;
}
// Physics
function physics(dt){
  // Moving platforms
  for (const mp of movingPlat) {
    const t = performance.now() / 1000 * mp.speed / 20;
    if (mp.vertical)
      mp.y = mp.baseY + Math.sin(t) * mp.range;
    else
      mp.x = mp.baseX + Math.sin(t) * mp.range;
  }

  // Input
  let dir = 0;
  if(keys['ArrowLeft']||keys['KeyA']) dir -= 1.5;
  if(keys['ArrowRight']||keys['KeyD']) dir += 1.5;
  player.vx = dir * player.speed;

  // Jump
  if ((keys['ArrowUp']||keys['Space']||keys['KeyW']) && player.onGround) {
    player.vy = -player.jump;
    player.onGround = false;
  }

if(keys['KeyK']){reset()}

  // Gravity
  player.vy += (world.gravity * dt) - 18;

  // Horizontal
  player.x += player.vx * dt;
  for (const p of platforms){
    if(rectsIntersect(player,p)){
      if(player.vx > 0) player.x = p.x - player.w;
      else if(player.vx < 0) player.x = p.x + p.w;
      player.vx = 0;
    }
  }

  // Vertical
  player.y += player.vy * dt;
  player.onGround = false;
  for (const p of platforms){
    if(rectsIntersect(player,p)){
      if(player.vy > 0){
        player.y = p.y - player.h;
        player.vy = 0;
        player.onGround = true;
      } else if (player.vy < 0){
        player.y = p.y + p.h;
        player.vy = 0;
      }
    }
  }

  // Coin collect
  for (const c of coins) {
    if (!c.picked) {
      const dx = (player.x+player.w/2)-c.x;
      const dy = (player.y+player.h/2)-c.y;
      if (Math.hypot(dx,dy) < c.r + player.w/2) {
        c.picked = true;
        score++;
      }
    }
  }

  // Pit
  if(player.y > 1500){
    reset();
  }
}

// Camera
function updateCam(){
  const targetX = player.x + player.w/2 - canvas.width/(2*DPR) + 120;
  const targetY = player.y + player.h/2 - canvas.height/(2*DPR) + 120;

  cam.x += (targetX - cam.x) * 0.12;
  cam.y += (targetY - cam.y) * 0.12;
}

function draw(){
  // Background
  if (bgImg.complete) {
    ctx.drawImage(bgImg, 0, 0, canvas.width / DPR, canvas.height / DPR);
  } else {
    ctx.fillStyle = world.color;
    ctx.fillRect(0,0,canvas.width/DPR,canvas.height/DPR);
  }

  ctx.save();
  ctx.translate(-cam.x, -cam.y);

  // Platforms
  ctx.fillStyle = '#F88379';
  for (const p of platforms)
    ctx.fillRect(p.x, p.y, p.w, p.h);

  // Coins
  for (const c of coins){
    if(c.picked) continue;
    ctx.beginPath();
    ctx.arc(c.x,c.y,c.r,0,Math.PI*2);
    ctx.fillStyle='#ffd166';
    ctx.fill();
    ctx.strokeStyle='rgba(0,0,0,0.12)';
    ctx.stroke();
  }

  // Player
  if (playerSprite.complete) {
  ctx.drawImage(playerSprite, player.x, player.y, player.w, player.h);}

  // Eyes
  ctx.fillStyle = '#fff';
  ctx.fillRect(player.x - 18, player.y - 14, 30, 30);
  ctx.fillRect(player.x + 22, player.y - 14, 30, 30);
  ctx.fillStyle = '#ff0000';
  ctx.fillRect(player.x - 8, player.y - 10, 15, 15);
  ctx.fillRect(player.x +32, player.y - 10, 15, 15);

  // Finish line
  ctx.fillStyle = '#ffb703';
  ctx.fillRect(2500, 240, 12, 120);

  ctx.restore();

  // HUD
  ctx.fillStyle = 'rgba(0,0,0,0.6)';
  ctx.fillRect(12,canvas.height/DPR-48,160,36);

  ctx.fillStyle = '#fff';
  ctx.font = '16px system-ui';
  ctx.fillText('Score: ' + score, 22, canvas.height/DPR-22);
}

// Game Loop
let last = performance.now();

function loop(now){
  const dt = Math.min(0.033, (now-last)/1000);
  last = now;

  physics(dt);
  updateCam();
  draw();

  requestAnimationFrame(loop);
}

// Start
level();
requestAnimationFrame(loop);
</script>
<h3>We're aware of background 6 being annoying but it is FUNNY so we're keeping it</h3>
<!--audio-->
<audio id="mus" src="../music/LetMeIn1hr.mp3"></audio>

<button onclick="document.getElementById('mus').play()">Play</button>
<button onclick="document.getElementById('mus').pause()">Pause</button>

</body>
</html>